var task1,task2,task3,task4,task4View,taskViews=[];var myList=[];$(function(){window.Task=Backbone.Model.extend({urlRoot:"/api/task/",url:"/api/task/",initialize:function(){if(this.url){this.fetch({success:function(c,b){},error:function(c,b){}})}},defaults:function(){return{date:new Date(),name:"New event",priority:0,id:2}}});window.Calendar=Backbone.Collection.extend({initialize:function(){},model:Task,comparator:function(b){return b.get("date")}});window.TaskView=Backbone.View.extend({tagName:"div",className:"task-item",initialize:function(){this.model.view=this},render:function(){var c='<h3><%= name %></h3><span class="importance"><%= priority %></span>';var b=_.template(c,this.model.toJSON());$(this.el).append(b);return this}});Tasks=Backbone.Collection.extend({model:Task,initialize:function(b){this.fetch()},parse:function(b){return b.objects},comparator:function(b){return b.get("priority")}});makeDate=function(d,e,b){if(b>28){var c;for(c=0;c<b;c++){if(e==2&&b>28){e=e+1;b=1}if(e==1||e==3||e==5||e==7||e==8||e==10||e==12){if(b>31){b=1;e=e+1}}if(e==4||e==6||e==9||e==11){if(b>30){b=1;e=1}}if(e>12){e=1}}if(e<10){e="0"+e}if(b<10){b="0"+b}}return d+"-"+e+"-"+b};now=new Date();today=makeDate(now.getFullYear(),(now.getMonth()+1),now.getDate());window.Day=Tasks.extend({url:"/api/v1/task/?calendar_id=1&date="+today,importanceLevel:0,});week=makeDate(now.getFullYear(),(now.getMonth()+1),now.getDate()+7);window.Week=Tasks.extend({url:"/api/v1/task/?calendar_id=1&date__gt="+today+"&date__lte="+week,importanceLevel:1,});fortnight=makeDate(now.getFullYear(),(now.getMonth()+1),now.getDate()+2*7);window.Fortnight=Tasks.extend({url:"/api/v1/task/?calendar_id=1&date__gt="+week+"&date__lte="+fortnight,importanceLevel:2,});month=makeDate(now.getFullYear(),(now.getMonth()+2),now.getDate());window.Month=Tasks.extend({url:"/api/v1/task/?calendar_id=1&date__gt="+fortnight+"&date__lte="+month,importanceLevel:3,});quarter=makeDate(now.getFullYear(),(now.getMonth()+4),now.getDate());window.Quarter=Tasks.extend({url:"/api/v1/task/?calendar_id=1&date__gt="+month+"&date__lte="+quarter,importanceLevel:4,});year=makeDate(now.getFullYear()+1,(now.getMonth()+1),now.getDate());window.Year=Tasks.extend({url:"/api/v1/task/?calendar_id=1&date__gt="+quarter+"&date__lte="+year,importanceLevel:5,});TasksView=Backbone.View.extend({initialize:function(){var b=this;this._taskViews=[];this.bind("add",this.render);this.collection.bind("reset",function(){this.each(function(d){console.log("Task: "+d.get("name")+" ("+d.get("priority")+") ["+b.collection.importanceLevel+"]");myList.push(d);if(d.get("priority")>=b.collection.importanceLevel){var c=new TaskView({model:d});b._taskViews.push(new TaskView({model:d,}))}});b.render()})},render:function(){var b=this;_(this._taskViews).each(function(c){$(b.el).append(c.render().el)})}});dayView=new TasksView({collection:new Day(),el:$("#day")});dayView.render();weekView=new TasksView({collection:new Week(),el:$("#week")});weekView.render();fortnightView=new TasksView({collection:new Fortnight(),el:$("#two-weeks")});fortnightView.render();monthView=new TasksView({collection:new Month(),el:$("#month")});monthView.render();threeMonthView=new TasksView({collection:new Quarter(),el:$("#three-months")});threeMonthView.render();yearView=new TasksView({collection:new Year(),el:$("#year")});yearView.render();var a=function(b){if(!(b&&b.url)){return null}return _.isFunction(b.url)?b.url():b.url};$(function(){$("form").submit(function(){formdict=jsonform($("form#add_task :input"));var b=new Task({date:formdict.date,name:formdict.name,priority:formdict.priority});console.log("new _task: "+b);b.save();date=b.get("date");return false})})});