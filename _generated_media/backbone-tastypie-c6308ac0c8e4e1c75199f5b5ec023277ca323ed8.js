(function(a){var b=this.Backbone;b.oldSync=b.sync;b.sync=function(f,e,d){if(f==="create"){var c=new $.Deferred();c.done(d.success);d.success=function(j,h,i){if(i.status===201&&!j){var g=i.getResponseHeader("Location");return $.ajax({url:g,success:c.resolve,error:c.reject})}else{return c.resolveWith(d.context||d,[j,h,i])}};c.fail(d.error);d.error=c.reject;c.request=b.oldSync(f,e,d);return c}return b.oldSync(f,e,d)};b.Model.prototype.idAttribute="resource_uri";b.Model.prototype.url=function(){var c=this.id;if(!c){c=this.collection&&(_.isFunction(this.collection.url)?this.collection.url():this.collection.url);c=c||this.urlRoot}c&&(c+=(c.length>0&&c.charAt(c.length-1)==="/")?"":"/");return c};b.Model.prototype.parse=function(c){return c&&c.objects&&(_.isArray(c.objects)?c.objects[0]:c.objects)||c};b.Collection.prototype.parse=function(c){return c&&c.objects};b.Collection.prototype.url=function(e){var c=this.urlRoot||(e&&e.length&&e[0].urlRoot);c&&(c+=(c.length>0&&c.charAt(c.length-1)==="/")?"":"/");if(e&&e.length){var d=_.map(e,function(f){var g=_.compact(f.id.split("/"));return g[g.length-1]});c+="set/"+d.join(";")+"/"}return c}})();